<%- include("partials/header") %>

<% if (typeof error !== "undefined") { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Error:</strong> <%= error %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% } %>

<div class="card p-4 shadow-sm mx-auto" style="max-width: 600px">
  <p class="text-muted mb-2">ðŸ”” Auto-deleted after <strong>30 days</strong></p>

  <form method="POST" action="/url">
    <div class="mb-3">
      <label class="form-label fw-bold">Enter Your URL</label>
      <input
        type="text"
        class="form-control"
        name="url"
        placeholder="https://example.com"
        required
      />
    </div>
    <button type="submit" class="btn btn-primary w-100">Generate</button>
  </form>
</div>

<% if (urls && urls.length > 0) { %>
<table
  class="table table-hover table-bordered text-center mt-4 shadow-sm bg-white"
>
  <thead class="table-primary text-dark">
    <tr>
      <th>S. No</th>
      <th>Short ID</th>
      <th>URL</th>
      <th>Clicks</th>
      <th>Days Left</th>
      <th>Action</th>
    </tr>
  </thead>

  <tbody>
    <% urls.forEach((url, index) => { const created = new Date(url.createdAt);
    const ageDays = Math.floor((Date.now() - created) / (1000*60*60*24)); const
    left = 30 - ageDays; %>
    <tr>
      <td><%= index+1 %></td>
      <td>
        <a href="/url/<%= url.shortId %>" target="_blank"><%= url.shortId %></a>
        <button
          class="btn btn-sm btn-outline-primary copy-btn"
          data-url="http://localhost:8001/url/<%= url.shortId %>"
        >
          Copy
        </button>
      </td>
      <td>
        <a href="<%= url.redirectURL %>" target="_blank"
          ><%= url.redirectURL %></a
        >
      </td>
      <td><%= url.visitHistory.length %></td>
      <td class="<%= left>0?'text-success':'text-danger'%> fw-bold">
        <%= left>0?left+' days':'Expired' %>
      </td>
      <td>
        <form action="/url/delete/<%= url.shortId %>" method="POST">
          <button class="btn btn-danger btn-sm">Delete</button>
        </form>
      </td>
    </tr>
    <% }) %>
  </tbody>
</table>
<% } %> <%- include("partials/footer") %>
